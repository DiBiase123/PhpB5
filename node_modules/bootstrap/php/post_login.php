<?php
session_start();
require_once('database.php');
$pdo = Database::connect();

$email = $_POST['email'];
$password = $_POST['password'];


if (empty($email) || empty($password)) 
    {
    $msg = 'Inserisci email e password %s';
    } else 
        {
        $query = "SELECT  username, email, password FROM users WHERE email = :email";
        $check = $pdo->prepare($query);
        $check->bindParam(':email', $email, PDO::PARAM_STR);
        $check->execute();
        ?>
        <div>
            <p>E-mail inserito : <?php echo ($email); ?></p>
            <p>Password inserito : <?php echo ($password); ?></p>
        </div>
        <?php  
        $email = $check->fetch(PDO::FETCH_ASSOC);

        //  Per una sicurezza maggiore esiste passowrd_verify(has)  *** DA ATTIVARE IN FUTURO?
        // if (!$user || password_verify($password, $user['password']) === false) 

        if (!$email ||  ($email['password']) != $password) 
            {
                $msg = 'Credenziali utente errate %s';
            } 
                else 
                    {
                        session_regenerate_id();
                        $_SESSION['session_id'] = session_id();
                        $_SESSION['session_user'] = $email['email'];
                        $_SESSION['session_user_username'] = $user['username'];
                        // $_SESSION['session_user_pwd'] = $user['password'];
                        echo('GG' );
                        
                        header('Location: home.php');
                    }
                    ?>
       
    <?php }
?>